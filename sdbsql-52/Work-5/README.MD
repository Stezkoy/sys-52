# Домашнее задание к занятию "`Резервное копирование баз данных`" - `Александр М.`

### Задание 1. Резервное копирование

### Кейс
Финансовая компания решила увеличить надёжность работы баз данных и их резервного копирования. 

Необходимо описать, какие варианты резервного копирования подходят в случаях: 

1.1. Необходимо восстанавливать данные в полном объёме за предыдущий день.

- Подходит ежедневный full backup, Он позволяет восстановить всю БД одним файлом.

1.2. Необходимо восстанавливать данные за час до предполагаемой поломки.

- Полный бэкап + WAL-логи (инкрементальные бэкапы). Восстанавливаем до нужного момента по времени.

1.3.* Возможен ли кейс, когда при поломке базы происходило моментальное переключение на работающую или починенную базу данных.

- Кластер с репликацией, например: master-slave или master-master и автоматическим failover. При поломке трафик перенаправляется на реплику.



---

### Задание 2. PostgreSQL

2.1. С помощью официальной документации приведите пример команды резервирования данных и восстановления БД (pgdump/pgrestore).

```
pg_dump -Fc postgres > postgres.dump # Бэкапим
pg_restore -C -d postgres postgres.dump # Востанавливаем
```
2.1.* Возможно ли автоматизировать этот процесс? Если да, то как?

- Конечно, простой вариант, скрипт в Crontab

Минимальный скрипт:
```
#!/bin/bash
pg_dump -Fc postgres > /путь/к/бэкапам/postgres_$(date +\%Y\%m\%d_\%H\%M\%S).dump
```

---

### Задание 3. MySQL

3.1. С помощью официальной документации приведите пример команды инкрементного резервного копирования базы данных MySQL. 

- Сначала делаем полный бэкап

```
mysqldump --flush-logs --master-data=2 -u root -p sakila > sakila.sql
```
- И инкремент
```
mysqlbinlog binlog.000001 binlog.000002 | mysql -u root -p
```


3.1.* В каких случаях использование реплики будет давать преимущество по сравнению с обычным резервным копированием?

- Реплика почти нулевое время простоя, чтение с реплики, меньше нагрузки на мастер по сравнению с бэкапами.

